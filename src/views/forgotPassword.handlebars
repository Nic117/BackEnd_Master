<div class="container py-5"></div>
    <div class="row justify-content-center">
        <div class="col-12 col-md-6 form-holder">
            <h1 class="text-center mb-4">Restablecer contraseña</h1>
            <form id="reset-password-form">
                <div class="mb-3">
                    <label class="form-label" for="email">Correo electrónico:</label>
                    <input type="email" id="email" name="email" class="form-control" required aria-required="true">
                </div>
                <button type="submit" class="btn btn-primary w-100 mb-3">Enviar solicitud</button>
            </form>
            <p class="text-center">¿No estás registrado? <a href="/register">Regístrarse</a></p>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/toastify-js"></script>

<script>
    const form = document.getElementById('reset-password-form');

    const showToast = (message, isSuccess = true) => {
        Toastify({
            text: message,
            duration: 3000,
            style: {
                background: isSuccess ? "linear-gradient(to right, #1e88e5, #42a5f5)" : "linear-gradient(to right, #e53935, #ef5350)"
            }
        }).showToast();
    };

    const handleResponse = (data) => {
        const message = data.status === 'success'
            ? 'Se ha enviado un correo electrónico con instrucciones para restablecer su contraseña.'
            : `Error: ${data.message}`;
        showToast(message, data.status === 'success');
    };

    const handleError = (error) => {
        console.error('Error:', error);
        showToast('Ha ocurrido un error. Por favor, inténtalo de nuevo.', false);
    };

    const isValidEmail = (email) => /^[\w-]+(\.[\w-]+)*@([\w-]+\.)+[a-zA-Z]{2,7}$/.test(email);

    const validateFormData = (data) => {
        const email = data.get('email');
        if (!isValidEmail(email)) {
            showToast('Por favor, introduce un correo electrónico válido.', false);
            return false;
        }
        return true;
    };

    form.addEventListener('submit', async (e) => {
        e.preventDefault();
        const data = new FormData(form);
        
        if (!validateFormData(data)) {
            return;
        }

        try {
            const response = await fetch('api/users/resetpassword', {
                method: 'POST',
                body: JSON.stringify(Object.fromEntries(data)),
                headers: {
                    'Content-Type': 'application/json'
                }
            });

            if (!response.ok) {
                const errorData = await response.json();
                throw errorData;
            }

            const result = await response.json();
            handleResponse(result);
        } catch (error) {
            handleError(error);
        }
    });
</script>